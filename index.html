<html>
  <head>
    <title>OurShopTools - Useful tools for e-commerce</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Nerko+One&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <meta name="description" content="Tools to take your commerce to the next level" />
    <meta property="og:title" content="OurShopTools - Useful tools for e-commerce" />
    <meta property="og:description" content="Tools to take your commerce to the next level" />
    <meta property="og:image" content="/icons/android-icon-192x192.png" />
    <meta property="og:url" content="https://OurShop.tools" />
    <meta name="twitter:title" content="OurShopTools - Useful tools for e-commerce" />
    <meta name="twitter:description" content="Tools to take your commerce to the next level" />
    <meta name="twitter:image" content="/icons/android-icon-192x192.png" />
    <meta name="twitter:card" content="summary" />

    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <style>

      :root {
        --animate-duration: 2s;
        --animate-delay: 0.9s;
      }

      * {
        font-family: 'Nerko One', cursive;
      }
      body {
        margin: 5px;
      }

      header {
        position: fixed;
      }

      header .text-logo {
        margin:0;
      }

      .logo {
        height: 100px;
      }

      main {
        height: calc(100vh - 33px);
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #FCD0A1;
        border-radius: 15px;
      }

      main > .container {
        width: fit-content;
        text-align:center;
        padding: 0 15px;
      }

      h1 {
        font-size: 2.5em;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      .btn-primary {
        padding: 7px 15px;
        border-radius: 5px;
        background-color: #fff;
        border: solid 2px #000;
        margin-bottom: 5px;
      }
      
      input[type="text"], input[type="email"], input[type="url"] {
        padding: 7px 15px;
        border-radius: 5px;
        background: transparent;
        display: block;
        margin: 0 auto;
        margin-bottom: 5px;
        width: 100%;
        border: solid 2px #000;
      }

      section {
        display: none;
      }

      section.active {
        display: block;
      }

      .text-icon {
        background: #fff;
        padding: 5px;
        width: 15px;
        height: 15px;
        display: inline-block;
        line-height: 15px;
        border-radius: 50%;
      }

      .dashed-underline {
        border-bottom: 2px #000 dashed;
      }
    </style>
  </head>
  <body>
    <header>
      <img class="logo" src="/logo.png" />
    </header>
    <main>
      <div class="container">
        <!-- Intro Section -->
        <section id="intro-section">
          <h1>Tools for your Paystack Storefront</h1>
          <button id="start-signup-flow" class="btn-primary">Set up custom domain</button>
        </section>
        <!-- End Intro Section -->

        <!-- Store URL Section -->
        <section id="store-url-section">
          <h1>Enter your Paystack Storefront URL</h1>
          <form action="" id="submit-store-url">
            <input type="text" name="storeUrl" id="storeURL" pattern="(https:\/\/)?(paystack.shop\/)([^\/\s]+)(.*)" placeholder="https://paystack.shop/your-store-name" required />
            <button type="submit" class="btn-primary">Set up custom domain</button>
          </form>
        </section>
        <!-- End Store URL Section -->

        <!-- Custom Domain Section -->
        <section id="custom-domain-section">
          <h1>Enter your custom domain</h1>
          <form action="" id="submit-custom-domain">
            <input type="text" name="customDomain" id="customDomain" placeholder="your-store-name.com" required />
            <button type="submit" class="btn-primary">Set up custom domain</button>
            <button id="backToStoreURL" class="btn-primary">Go back</button>
          </form>
          <p><span class="text-icon">?</span> <a href="#" class="dashed-underline">How do I purchase a domain?</a></p>
        </section>
        <!-- End Custom Domain Section -->

        <!-- Email Address Section -->
        <section id="email-address-section">
          <h1>Enter your email address</h1>
          <form action="" id="submit-email-address">
            <input type="email" name="emailAddress" id="emailAddress" placeholder="you@domain.com" required />
            <button type="submit" class="btn-primary">Receive updates from us</button>
            <button id="backToCustomDomain" class="btn-primary">Go back</button>
          </form>
          <a href="#" id="skipEmail" class="dashed-underline">Skip this</a>
        </section>
        <!-- End Email Address Section -->

        <!-- Provisioning Section -->
        <section id="provisioning-section">
          <h1>Please wait while we set things up...</h1>
        </section>
        <!-- End Provisioning Section -->

        <!-- Error Section -->
        <section id="error-section">
          <h1>There's been an error. Please try again shortly</h1>
        </section>
        <!-- End Error Section -->

        <!-- Setup Section -->
        <section id="setup-section">
          <h1>Set up your custom domain</h1>
          <ul>
            <li>Go to your DNS Provider</li>
            <li>Add new A records on <span id="yourDomainHolder"></span></li>
            <li>Set the A record value to <span id="aRecordHolder"></span></li>
            <li>Domain changes may take up to 48 hours</li>
          </ul>
          <button id="provisionDomain" class="btn-primary">I'm done with this</button>
          <p><span class="text-icon">?</span> <a href="mailto:appswknd@gmail.com" class="dashed-underline">I don't know what to do</a></p>
        </section>
        <!-- End Setup Section -->

        <!-- Success Section -->
        <section id="success-section">
          <h1>Success!</h1>
          <p>Your storefront should go live soon</p>
          <p>Visit <a id="provisionedDomainLink" class="dashed-underline" href="#"></a> to see.</p>
          <p><span class="text-icon">?</span> Have any more questions? <a href="mailto:appswknd@gmail.com" class="dashed-underline">Shoot us an email</a></p>
        </section>
        <!-- End Success Section -->
      </div>
    </main>
  </body>
  <script>
    $ = (query, selectAll=false) => (
      selectAll ?
      document.querySelectorAll(query) :
      document.querySelector(query)
    )

    const ROUTES = {
      INDEX: "intro-section",
      STORE_URL: "store-url-section",
      CUSTOM_DOMAIN: "custom-domain-section",
      EMAIL_ADDRESS: "email-address-section",
      PROVISIONING: "provisioning-section",
      ERROR: "error-section",
      SETUP: "setup-section",
      SUCCESS: "success-section"
    };

    let store_url = "";
    let domain = "";
    let email = "";

    navigateTo = (page) => {
      const section = $("section.active");
      if (section) {
        section.classList.remove('active');
        visibleSection = $(`#${page}`);
        visibleSection.classList.add('animate__animated', 'animate__fadeIn', 'active');
      } else {
        visibleSection = $(`#${page}`);
        visibleSection.classList.add('animate__animated', 'animate__fadeIn', 'active');
      }
    }

    provisionStorefront = () => {
      navigateTo(ROUTES.PROVISIONING);
      
      xhr = new XMLHttpRequest();

      xhr.addEventListener("load", (event) => {
        if (event.target.readyState === 4 && event.target.status === 200) {
          const response = JSON.parse(event.target.responseText);
          $('#aRecordHolder').innerHTML = response.a_record;
          $('#yourDomainHolder').innerHTML = domain;
          navigateTo(ROUTES.SETUP);
        } else {
          navigateTo(ROUTES.ERROR);
        }
      });

      xhr.open("POST", "https://api.ourshop.tools/api/store");
      xhr.setRequestHeader('Content-type', 'application/json');
      xhr.setRequestHeader('Accept', 'application/json');
      xhr.send(JSON.stringify({
        domain,
        store_url,
        email
      }));
    }

    navigateTo(ROUTES.INDEX);

    $("#start-signup-flow").addEventListener("click", () => {
      navigateTo(ROUTES.STORE_URL);
    });

    $("#submit-store-url").addEventListener("submit", (event) => {
      event.preventDefault();
      store_url = event.target.storeURL.value;
      navigateTo(ROUTES.CUSTOM_DOMAIN);
    });

    $("#submit-custom-domain").addEventListener("submit", (event) => {
      event.preventDefault();
      domain = event.target.customDomain.value;
      navigateTo(ROUTES.EMAIL_ADDRESS);
    });

    $("#submit-email-address").addEventListener("submit", (event) => {
      event.preventDefault();
      
      email = event.target.emailAddress.value;

      provisionStorefront();
    });

    $("#skipEmail").addEventListener("click", () => {
      provisionStorefront();
    });

    $("#provisionDomain").addEventListener("click", () => {
      navigateTo(ROUTES.PROVISIONING);
      xhr = new XMLHttpRequest();

      xhr.addEventListener("load", (event) => {
        if (event.target.readyState === 4 && event.target.status === 200) {
          $("#provisionedDomainLink").innerHTML = domain;
          $("#provisionedDomainLink").href = `https://${domain}`;

          setTimeout( () => (navigateTo(ROUTES.SUCCESS)), 3000 );
        } else {
          navigateTo(ROUTES.ERROR);
        }
      });

      xhr.open("GET", `https://api.ourshop.tools/api/provision?domain=${domain}`);
      xhr.setRequestHeader('Content-type', 'application/json');
      xhr.setRequestHeader('Accept', 'application/json');
      xhr.send();
    })

    $("#backToStoreURL").addEventListener("click", (event) => {
      event.preventDefault();
      navigateTo(ROUTES.STORE_URL);
    })

    $("#backToCustomDomain").addEventListener("click", (event) => {
      event.preventDefault();
      navigateTo(ROUTES.CUSTOM_DOMAIN);
    })
  </script>
</html>